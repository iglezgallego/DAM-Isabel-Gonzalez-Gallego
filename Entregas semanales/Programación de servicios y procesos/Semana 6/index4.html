<!doctype html>
<html>
    <head>
        <style>
            html, body{
                padding:0px;
                margin:0px;
                overflow: hidden;
            }
            canvas{
                border:1px solid black;
                /* Para quitar antialias */
                image-rendering: -moz-crisp-edges;
                image-rendering: -o-crisp-edges;
                image-rendering: -webkit-optimize-contrast;
                image-rendering: pixelated;
                image-rendering: optimize-contrast;
                -ms-interpolation-mode: nearest-neighbor;
            }
            #contienejvstats{
               position:absolute;
                top:0px;
                left:0px;
                width: 94px;
                height: 62px;
            }
            #jvstats{
                position:absolute;
                top:0px;
                left:0px;
                background:black;
            }
            #jvstats2{
                position:absolute;
                top:0px;
                left:0px;
            }
            
        </style> 
    </head>
    <body>
        <canvas width=512px height=512px id="lienzo"></canvas>
        <div id="contienejvstats">
            <!-- Lienzo para el gráfico del rendimiento -->
            <canvas width=94px height=62px id="jvstats"></canvas>
            <!-- Lienzo para el texto gráfico del rendimiento -->
            <canvas width=94px height=62px id="jvstats2"></canvas>
        </div>
        <script>
            //cojo la anchura y la altura de las dimensiones de la pantalla
            var anchura = window.innerWidth;
            var altura = window.innerHeight;
            document.getElementById("lienzo").width = anchura;
            document.getElementById("lienzo").height = altura;
            //creamos el contexto del lienzo
            var contexto = document.getElementById("lienzo").getContext("2d");
            
            //Carga inicial de pixeles negros
            contexto.fillStyle = "rgb(255,255,255)"
            contexto.fillRect(0,0,anchura,altura)
            var datoscanvas = contexto.getImageData(0,0,anchura,altura)
            
            //creo una variable igual a nuevo array
            var pixel = new Array();
            
            //Creamos pixeles blancos y negros aleatorios por el lienzo que seran la celulas
            //Iteramos en todos los pixeles del lienzo
            for(var i = 0;i<anchura*altura;i++){
                //creo numero aleatorios entre 0 y 1, si el numero aleatorio es menor a 0.2
                if(Math.random() < 0.1){
                    //pon un 1 al final de array pixel, pinta el pixel de negro
                    pixel.push(1)
                }else{
                    //pon un 0 al final de array pixel, pinta el pixel de blanco
                    pixel.push(0)
                }
            }
            //console.log(pixel)
            
            //CONTEXTO DEL LIENZO DEL PROGRAMA
            contexto.putImageData(datoscanvas,0,0)
            
            //CONTEXTO DEL LIENZO DE LA GRÁFICA DE RENDIMIENTO
            contextojvstats = document.getElementById("jvstats").getContext("2d")
            //contexto para la fuente del lienzo
            contextojvstats2 = document.getElementById("jvstats2").getContext("2d")
            //poner texto al lienzo
            contextojvstats.font = "10px Arial";
            //color del cuadrado para la gráfica
            contextojvstats.fillStyle = "black"
            //dibujo el cuadrado
            contextojvstats.fillRect(0,0,94,62)
            
            //creo variables para el inicio y el final
            var jvstatstiempoinicio = 0;
            var jvstatstiempofinal = 0;
            
            
            //creo un temporizador para iniciar la funcion bucle
            var temporizador = setTimeout("bucle()",1000);
            //defino la funcion bucle
            function bucle(){
                //capturo el tiempo inicial para la gráfica de rendimiento
                jvstatstiempoinicio = Date.now();
                
                //creamos una copia de la variable pixel
                var pixeltemp = pixel.slice();
                
                //LEER LAS CELULAS DE ALREDEDOR DE CADA UNA
                //para cada una de las celulas quiero leer las 8 celulas que tiene a su alrededor
                for(var i = 0;i<pixel.length;i++){
                    numerovivas = 0;
                    //leo todos los pixeles que hay alrededor de la célula, solo mirando el componente rojo i
                    //la celula de arriba a la izquierda
                    numerovivas += pixeltemp[i-anchura-1];
                    //la celula de arriba está viva
                    numerovivas += pixeltemp[i-anchura];
                    //la celula de arriba a la derecha
                    numerovivas += pixeltemp[i-anchura+1];
                    //celula de la izquierda
                    numerovivas += pixeltemp[i-1];
                    //celula de la derecha
                    numerovivas += pixeltemp[i+1];
                    //La celula de abajo a la izquierda
                    numerovivas += pixeltemp[i+anchura-1];
                    //La celula de abajo
                    numerovivas += pixeltemp[i+anchura];
                    //la celula de abajo a la derecha
                    numerovivas += pixeltemp[i+anchura+1];
                    
                    //APLICAMOS LAS NORMAS DEL JUEGO
                    //si la celula esta muerta 
                    if(pixeltemp[i] == 0){
                        //si el numero de vivas alrededor es igual a 3
                        if(numerovivas == 3){
                            //el pixel está vivo, es decir, la celula nace
                            pixel[i] = 1;
                        //en caso contrario
                        }else{
                            //la celula sigue muerta
                            pixel[i] = 0;
                        }
                    //en caso de que la celula esté viva
                    }else{
                        //si numero de vivas alrededor es igual a 2 o a 3
                        if(numerovivas == 2 || numerovivas == 3){
                            //la celula sigue viva
                            pixel[i] = 1
                        //en caso contrario
                        }else{
                            //la celula muere
                            pixel[i] = 0;
                        }
                    }
                    
                    //PINTAMOS LAS CELULAS SEGUN LAS NORMAS APLICADAS
                    //pinto los pixeles con en los componentes rgba
                    //componente rojo
                    datoscanvas.data[i*4] = 255-pixel[i]*255
                    //componente verde
                    datoscanvas.data[i*4+1] = 255-pixel[i]*255
                    //componente azul
                    datoscanvas.data[i*4+2] = 255-pixel[i]*255
                    //componente transparencia o alfa
                    datoscanvas.data[i*4+3] = 255
                }
                
                //los datos que he modificado los convierto en una imagen
                contexto.putImageData(datoscanvas,0,0)
                
                //PINTAR LA GRÁFICA DE RENDIMIENTO
                //capturo el tiempo final para la gráfica en milisegundos
                jvstatstiempofinal = Date.now();
                //creo una variable para los fotogramas por segundo redondeado
                var fps = Math.round(1000/(jvstatstiempofinal - jvstatstiempoinicio))
                //si los fps son mayor o igual a 30 la barra será verde
                if(fps >= 30){contextojvstats.fillStyle = "green"}
                //si los fps son menos de 30 la barra será amarilla
                if(fps < 30){contextojvstats.fillStyle = "yellow"}
                //si los fps son menos de 15 la barra será roja
                if(fps < 15){contextojvstats.fillStyle = "red"}
                
                //para pintar las barras verdes de las gráfica de rendimiento
                //contextojvstats.fillStyle = "green"
                contextojvstats.fillRect(92,60,1,0-fps/2)
                var datos = contextojvstats.getImageData(2,1,94,62)
                contextojvstats.putImageData(datos,1,1)
                //escribir el texto en el lienzo
                contextojvstats2.clearRect(0,0,94,62)
                contextojvstats2.fillStyle = "white"
                contextojvstats2.fillText(fps+"fps", 10, 45)
                
                //limpio el anterior temporizador
                clearTimeout(temporizador);
                //vuelvo a arrancar el temporizador
                temporizador = setTimeout("bucle()",0);
            }
        </script>
    
    </body>

</html>