<html>
    <head>
    
    </head>
    <body>
        <canvas id="lienzo" width=512px height="512px"></canvas>
        <script>
            //defino una serie de trabajadores
            var numerotrabajadores = 30;
            //los trabajadores serán un array donde en cada uno habrá un worker
            var trabajadores = new Array();
            //Los personajes serán un array
            var personajes = new Array();
            
            //especifica un contexto en el cual se va a dibujar
            var contexto = document.getElementById("lienzo").getContext("2d")
            //creo temporizador vacio
            var temporizador;
            //creo la variable comida que sera un array
            var comida = new Array();
            var numerocomida = 20;
            //creamos tantas comidas como numerocomidas tengamos
            for(var i=0; i<numerocomida; i++){
                comida[i] = {
                    //indicamos posiciones aleatorias para cada una de las comidas
                    x:Math.random()*512,
                    y:Math.random()*512
                }
            }
            
            //para cada uno de los trabajadores
            for(var i = 0;i<numerotrabajadores;i++){
                //asigno un worker a cada trabajador 
                trabajadores[i] = new Worker("tarea8.js");
                //envia el id de cada trabajador
                trabajadores[i].postMessage({id:i})
                //cuando nacen los personajes trae la información
                personajes[i] = {x:0,y:0,r:0,g:0,b:0,otros:0,id:i}
                //recibe la informacion de donde se encuentran los puntos
                trabajadores[i].onmessage = function(datos){
                    personajes[datos.data.id].x = datos.data.x
                    personajes[datos.data.id].y = datos.data.y
                    personajes[datos.data.id].r = datos.data.mir
                    personajes[datos.data.id].g = datos.data.mig
                    personajes[datos.data.id].b = datos.data.mib
                    personajes[datos.data.id].tam = datos.data.tam
                }
            }
            
            //trabajamos con un bucle en el principal y otros bucles en tarea.js
            //llama la funcion de inicio
            inicio();
            //define la funcion de inicio
            function inicio(){
                //dentro de un segundo se ejecutará el bucle
                temporizador = setTimeout("bucle()",1000)
            }
            //define la funcion de bucle
            function bucle(){
                //mascara para que los personajes dejen un rastro
                contexto.fillStyle = "rgba(255,255,255,0.1)"
                contexto.fillRect(0,0,512,512)
                
                //dibujo cada una de las comidas
                for(var i=0; i<numerocomida; i++){
                    //Establece el color de relleno del círculo en "rojo".
                    contexto.fillStyle = "red";
                    //Inicia un nuevo camino para dibujar el círculo.
                    contexto.beginPath();
                    // Dibuja un círculo en el lienzo con las siguientes propiedades:
                        // - Posición X: comida[i].x
                        // - Posición Y: comida[i].y
                        // - Radio: 20 px
                        // - Ángulo inicial: 0 radianes (comienzo)
                        // - Ángulo final: Math.PI * 2 (un círculo completo, 360 grados)
                        // - Sentido horario: true
                    contexto.arc(comida[i].x,comida[i].y,5,0,Math.PI*2,true)
                    //Rellena el circulo
                    contexto.fill();
                }
                
                for(var i=0;i<numerotrabajadores;i++){
                    //Pinta cada uno de los puntos
                    contexto.fillStyle = "rgb("+personajes[i].r+","+personajes[i].g+","+personajes[i].b+")"
                    contexto.fillRect(personajes[i].x,personajes[i].y,personajes[i].tam,personajes[i].tam)
                    //a cada uno de los personajes le paso información de los otros personajes y de la comida
                    trabajadores[i].postMessage({id:i,otros:personajes,comida:comida})
                }
                
                //elimino el temporizador anterior para refrescarlo
                clearTimeout(temporizador)
                //creo un nuevo temporizador recursivo que llama a la misma función
                temporizador = setTimeout("bucle()",33)
            }
        </script>
    </body>
</html>